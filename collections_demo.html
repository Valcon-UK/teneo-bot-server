<html>
 <head>
  <meta charset="UTF-8">


 
<script>
function findGetParameter(parameterName) {
    var result = null,
        tmp = [];
    var items = location.search.substr(1).split("&");
    for (var index = 0; index < items.length; index++) {
        tmp = items[index].split("=");
        if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
    }
    return result;
}
function show_position (position)
{
    console.log(position);
    var position_text = 'Lat: ' + position.coords.latitude + ', Lon: ' + position.coords.longitude;
    console.log(position_text);
    var sessionId = findGetParameter('session_id');
    console.log('session: ' + sessionId);
    var target = document.getElementsByTagName('body')[0];
    target.appendChild(document.createTextNode(position_text));
    // Create request object 
    var parameters = {};
    parameters["latitude"] = position.coords.latitude;
    parameters["longitude"] = position.coords.longitude; 
    parameters["channel"] = 'geoloc';
      var contentToTeneo = {'text': 'coordinates', "parameters": JSON.stringify(parameters), 'channel':'geoloc'};
       console.log("Content to Teneo: " + JSON.stringify(contentToTeneo).toString());
      var request = new Request('https://afs-customer-services-sms.herokuapp.com/', 
         { method: 'POST', 
           body: contentToTeneo, 
           mode: 'no-cors',
           headers: { 'Content-Type': 'application/json', 'cookie': 'JESSIONID=${sessionId}' } 
         });
       console.log(request);
       console.log(request.headers.get('cookie'));
       // Now use it! 

      fetch(request) 
       /*.then(resp => { 
             // handle response 
            console.log(resp);
       }) */
       .catch(err => { 
             // handle errors 
        });
}

function geolocate()
{
    if( navigator.geolocation )
    {
        navigator.geolocation.getCurrentPosition( show_position );
         
    }
    else
    {
        position_text = "Positioning not supported";
    }
}
  window.onload = function () 
  { 
   geolocate();
  }
 

  </script>
    </head>
    <body>

<p id="demo"></p>


<img crossOrigin="anonymous" src="https://avj-images.s3.eu-west-2.amazonaws.com/convaiback.png"/>
 


    </body>
</html>
